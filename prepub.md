

Реализация истории изменений страниц и возможность финальной публикации страницы после серии итераций
=====================================================================================================
 
Функционал
----------

1. Необходимо хранить историю изменений страниц 
   (последние N изменений или все изменения за определенный период)
2. Должна быть возможность откатить состояния опубликованной на сайте страницы до состояния страницы 
   в истории изменения.
3. Должна поддерживаться препубликация страниц nCMS, когда редактор может 
   произвести несколько итераций редактирование-предпросмотр и затем 
   опубликовать финальную версию примененных изменений.
4. Должна поддерживаться блокировка страниц редактором в процессе модификации страниц.
   В этом режиме редактор имеет эксклюзивный доступ к странице и он снимается 
   после ухода редактора с раздела редактирования страницы. 
5. Если страница ссылается на другие страницы или файлы - это фиксируется в БД,
   формируя граф связанности страниц.  
      
      
      
Текущая архитектура хранения страниц
-------------------------------------

В текущей версии nCMS страница это множество связанных записей
в реляционных таблицах БД и множество файлов в медиарепозитории nCMS 
связанных со странницей. Страницы связаны друг с другом и эти ссылки записаны 
в БД. При сохранении страницы - меняется состояние некоторого набора строк в таблицах 
связанных со страницей.
     
     
Планируемая архитектура
-----------------------
      
1. Клиентская часть амин зоны nCMS (JS в браузере) должна быть связана с сервером в реальном времени,
   используя websockets. Это необходимо для управления блокировками страниц в реальном времени, получение 
   клиентской частью уведомлений о изменениях в структуре сайта и автоматическое обновление структуры сайта 
   для всех подключенных клиентов.
     
2. Для реализации поддержки истории изменений необходимо реализовать так называемые теневые страницы (shadow pages) - 
   это изменяемая редактором копия последней опубликованной страницы, которая станет видимой для пользователям
   сайта после публикации изменений редактора (другими словами это следующая еще не опубликованная версия страницы). 
   Эта наиболее сложная часть реализации - поскольку с технической стороны нам необходимо делать копию всего  
   графа данных, связанных со страницей, а затем при публикации подменять ткущую версию страницы сайта на копию, 
   а также переписать все ссылки извне на старую страницу. И здесь есть серьезная сложность в самой сути 
   процесса процесса управления shadow-страницами, а также могут возникнуть вопросы производительности 
   раздела редактора страниц (процесс создания shadow копии сложен и его нужно будет оптимизировать)
            
            
Вариант использования истории страниц
-------------------------------------
            
1. **Состояние:** редактор у которого достаточно прав для редактирования страницы
   находится во вкладке редактирования страницы.
            
    1.1 При первом изменении содержания страницы создается теневая копия страницы 
        и блокируется доступ к странице для других редакторов.
        
    1.2 В процессе редактирования редактор может осуществлять визуальный просмотр 
        теневой копии страницы и итеративно вносить корректировки в контент.
                 
    1.3 Редактор может прервать процесс редактирования. В этом случае теневая 
        копия страницы удаляется, страница разблокируется.         
                 
    1.3 При финальной публикации страницы: 
        1.3.1 Текущая версия страницы заменяется на теневую. 
        1.3.2 Поправляются ссылки из других страниц на файлы и новую страницу.  
        1.3.3 Бывшая текущая страница помечается, как находящаяся в истории.
        1.3.4 Раздел редактирования страницы разблокируется для других редакторов сайта.
        
2. **Состояние:** редактор перешел в раздел редактирования страницы, которая
   уже редактируется другим редактором. В этом случае редактор видит в режиме 
   только-чтение текущее состояние страницы. И может отметить опцию: *Уведомить меня по эл. почте/тел.*
   когда страница разблокируется.   
          
         
         
                 
                     
            
     
     
     
     
           
                                            


  
  