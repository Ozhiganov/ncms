<!DOCTYPE html>
<html>
<head>
    $!{asm("head")}
</head>
<body>
#set(XMLConfiguration cfg = config())
#set(String iuserRef = cfg.getString("instagram.user-ref"))
#set(String iclientId = cfg.getString("instagram.client-id"))
#set(Long iuserId = cfg.getLong("instagram.user-id"))
<div id="wrapper">
    <div class="w1">
        <header id="header">
            ${include("inc/header.httl")}
        </header>
        <div id="main" class="newsmain-page">
            ${include("inc/breadcrumbs.httl")}
            <h1>Главные события</h1>
            <ul class="news-list list3">
                #foreach(Asm p in events)
                <li>
                    #set(Image img = p.asm("bigicon"))
                    #if(img != null)
                    <div class="img-holder" style="width:314px;height:192px;overflow:hidden">
                        <a href="${p.link}"><img src="${img.link}" alt="${p.hname}"/></a>
                        #set(Date edate = p.eventDate)
                        <div class="date-holder">
                            <span class="date">${edate.format2("dd")}</span>
                            <span class="month">${edate.format2("MMM")}</span>
                            <span class="year">${edate.format2("yyyy")}</span>
                        </div>
                    </div>
                    #end
                    <div class="text-holder">
                        <h3><a href="${p.link}">${p.hname}</a></h3>

                        <p>${p.asm("annotation")}</p>
                        #if(p.isHasAttribute("subcategory"))
                        #foreach(SelectNode sn in p.asm("subcategory"))
                        <span class="tag">${sn.key}</span>
                        #end
                        #end
                    </div>
                </li>
                #end
            </ul>

            <h1>Фото</h1>
            #set(Tree tree = photoline)
            #if(tree != null && tree.hasChildren)
            <div class="photo-line">
                <div class="viewport">
                    <ul class="overview ad-list2">
                        #foreach(Tree n in tree)
                        <li>
                            <a href="$!{n.richRef.link}">
                                #if(n.richRef.style != null)
                                <span class="photo">${n.richRef.style}</span>
                                #end
                                <div>
                                    <img src="$!{n.richRef.image.link}" alt="${n.richRef.name}"/>
                                </div>
                                #if(n.richRef.name != null)
                                <h4>${n.richRef.name}</h4>
                                #end
                            </a>
                        </li>
                        #end
                    </ul>
                </div>
            </div>
            #end

            #if(iclientId != null && iuserId != null)
            <div class="instagramm-holder" style="display: none;">
                <div class="title-holder">
                    <h1>NSU Instagram</h1>
                    #if(iuserRef != null)
                    <a href="$!{iuserRef}" class="view" target="_blank">
                        <img src="images/img40.jpg" width="138" height="26" alt=""/>
                    </a>
                    #end
                </div>
                <ul class="photo-list">
                </ul>
            </div>
            #end

            <div id="news-holder" class="news-holder">
                <ul class="tabset">
                    #foreach(Pair nc in news_categories)
                    #set(String type = nc.one)
                    #if(type == news_active_type)
                    #set(String activeType = type)
                    <li class="active"><a>${nc.two}</a></li>
                    #else
                    <li><a href="$!{page().link}?mnc.news.type=${type.encodeUriComponent}">${nc.two}</a></li>
                    #end
                    #end
                </ul>
                <div id="news-container" class="list-holder">
                    $!{include("inc/news_main_news.httl")}
                </div>
                <a id="news-fetch-more" class="fetch-more"><span>Загрузить еще</span></a>
            </div>
            ${include("inc/soclikes.httl")}
            ${include("inc/partners.httl")}
        </div>
        <footer id="footer">
            ${include("inc/footer.httl")}
        </footer>
    </div>
</div>
$!{include("inc/scripts.httl")}
#if(!requestParamMatched("preview_frame", 1))
<script type="text/javascript" src="js/instagram.js"></script>
<script type="text/javascript">
    #if(iclientId != null && iuserId != null)
    #set(String icacheKey = cfg.getString("instagram.cache.key"))
    #set(Long icacheTimeout = cfg.getLong("instagram.cache.timeout"))
    $('.instagramm-holder > ul.photo-list').instagramLite({
        clientID : '${iclientId}',
        userID : ${iuserId},
        limit : 6,
        urls : true,
        localstore :
        #if(icacheKey != null)
            {
                key : '${icacheKey}',
                timeout : #if(icacheTimeout != null)${icacheTimeout}#else 3600000#end
            }
        #else
            null
        #end
        ,
        success : function(fromCache) {
            if (fromCache) {
                $('.instagramm-holder').show();
            } else {
                $('.instagramm-holder').slideDown();
            }
        }
    });
    #end

    window.initScroll && $(function() {
        initScroll('ul.tabset', 'nsu:news');
    });
    window.initNewsMain && $(function(){
        initNewsMain(${news_limit});
    });
</script>
#end
</body>
</html>
