<?xml version="1.0" encoding="utf-8" ?>

<configuration>
    <app-name>Ncms</app-name>
    <help-site>http://nsu.ru</help-site>
    <logout-redirect>http://nsu.ru</logout-redirect>
    <!--<tmpdir>used java.io.tmpdir by default</tmpdir>-->

    <ncms-prefix>/ncms</ncms-prefix>

    <jar-web-resources>
        <resource>
            <path-prefix>/</path-prefix>
            <options>/ncms-engine-qx/ncms</options>
        </resource>
    </jar-web-resources>

    <mybatis config="com/softmotions/ncms/db/myibatis-config.xml"
             bindDatasource="true"
             shutdownSQL="SHUTDOWN">
        JDBC.driver=org.h2.Driver
        JDBC.url=jdbc:h2:mem:ncms
        #JDBC.url=${ncms.JDBC.url}
        JDBC.username=sa
        JDBC.password
    </mybatis>

    <liquibase changelog="com/softmotions/ncms/db/changelog/db-changelog-master.xml">
        <dropAll/>
        <update/>
    </liquibase>

    <!-- basedir replacements: {webapp}|{cwd}|{home}|{tmp}|{newtmp} -->
    <media basedir="{newtmp}/media">
        <max-upload-size>31457280</max-upload-size>
        <max-upload-inmemory-size>1048576</max-upload-inmemory-size>
        <locks-lrucache-size>127</locks-lrucache-size>
        <thumbnails-width>150</thumbnails-width>
    </media>

    <httl extensions="*,httl,html">
        loggers=httl.spi.loggers.Slf4jLogger
        loaders=com.softmotions.ncms.asm.render.httl.HttlLoaderAdapter
        import.methods+=com.softmotions.ncms.asm.render.httl.HttlAsmMethods
        value.filters=com.softmotions.ncms.asm.render.httl.HttlValueFilter
    </httl>

    <security dbJndiName="java:comp/env/WSUserDatabase">
        <web-fakeuser>admin</web-fakeuser>
        <web-access-control-allow>*</web-access-control-allow>
    </security>

    <modules>
        <module class="com.softmotions.ncms.security.NcmsSecurityModule"/>
        <module class="com.softmotions.ncms.asm.AsmModule"/>
        <module class="com.softmotions.ncms.asm.render.httl.AsmTemplateEngineHttlModule"/>
        <module class="com.softmotions.ncms.adm.AdmRestModule"/>
        <module class="com.softmotions.ncms.jaxrs.JAXRSExceptionHandlingModule"/>
    </modules>

    <ui>
        <navigation-selectors>
            <widget qxClass="ncms.pgs.PagesNav" roles="user"/>
            <widget qxClass="ncms.mmgr.MediaNav" roles="user"/>
            <widget qxClass="ncms.asm.AsmNav" roles="admin.asm"/>
            <widget qxClass="ncms.usr.UsersNav" roles="admin.users"/>
        </navigation-selectors>
    </ui>

</configuration>