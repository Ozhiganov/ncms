<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.softmotions.ncms.asm.PageRS">


    <select id="selectChildLayer" resultType="map" parameterType="map">
        SELECT
        p.id AS "id",
        p.name AS "guid",
        p.hname AS "name",
        p.description AS "description",
        p.type AS "type",
        p.published AS "published",
        p.template AS "template"
        FROM ASMS AS p
        WHERE p.nav_parent_id = #{nav_parent_id}
        AND p.type LIKE 'page%'
        ORDER BY p.hname ASC
    </select>


    <select id="selectRootLayer" resultType="map" parameterType="map">
        SELECT
        p.id AS "id",
        p.name AS "guid",
        p.hname AS "name",
        p.description AS "description",
        p.type AS "type",
        p.published AS "published",
        p.template AS "template"
        FROM ASMS AS p
        WHERE p.nav_parent_id IS NULL
        AND p.type LIKE 'page%'
        ORDER BY p.hname ASC
    </select>


    <insert id="insertNewPage" parameterType="map">
        INSERT INTO ASMS (name, hname, type,
        nav_parent_id, options,
        mdate, muser, owner)
        VALUES (#{guid}, #{name}, #{type},
        #{nav_parent_id,jdbcType=BIGINT}, #{options,jdbcType=VARCHAR},
        now(), #{user}, #{user})
    </insert>


    <delete id="dropPage" parameterType="map">
        DELETE
        FROM asms
        WHERE id = #{id}
    </delete>


    <update id="setPageOwner" parameterType="map">
        UPDATE asms
        SET owner = #{owner}
        WHERE id = #{id}
    </update>


    <select id="selectPageInfo" resultType="map" parameterType="map">
        SELECT
        p.id AS "id",
        p.hname AS "name",
        p.name AS "guid",
        p.type AS "type",
        p.mdate AS "mdate",
        p.muser AS "muser",
        p.owner AS "owner",
        p.published AS "published",
        p.template AS "template",
        p.options AS "options"
        FROM ASMS AS p
        WHERE p.id = #{id}
              AND p.type LIKE 'page%'
    </select>

</mapper>