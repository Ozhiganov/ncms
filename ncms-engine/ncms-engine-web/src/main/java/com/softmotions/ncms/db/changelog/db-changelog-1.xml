<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="1" author="adamansky@gmail.com">

        <!-- ===================== ASMS ========================== -->

        <createTable tableName="ASMS"
                     remarks="Assemblies">
            <column name="id" type="java.sql.Types.BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="java.sql.Types.VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="java.sql.Types.VARCHAR(256)"/>
        </createTable>

        <createIndex tableName="ASMS"
                     indexName="IDX_ASMS_NAME"
                     unique="true">
            <column name="name"></column>
        </createIndex>

        <!-- ==================== ASM_ATTRS ======================= -->

        <createTable tableName="ASM_ATTRS"
                     remarks="Assembly attributes">
            <column name="asm_id" type="java.sql.Types.BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="java.sql.Types.VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex tableName="ASM_ATTRS"
                     indexName="IDX_ASMATTRS_UNIQ"
                     unique="true">
            <column name="name"></column>
            <column name="asm_id"></column>
        </createIndex>

        <!-- FK ASM_ATTRS => ASM  -->
        <addForeignKeyConstraint baseTableName="ASM_ATTRS"
                                 baseColumnNames="asm_id"
                                 constraintName="FK_ASMATTRS_ASM"
                                 referencedTableName="ASMS"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

        <!-- ================ ASSEMBLY PARENTS ==================== -->

        <createTable tableName="ASM_PARENTS">
            <column name="asm_id" type="java.sql.Types.BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="asm_parent_id" type="java.sql.Types.BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex tableName="ASM_PARENTS"
                     indexName="IDX_ASMPARENTS_UNIQ"
                     unique="true">
            <column name="asm_id"></column>
            <column name="asm_parent_id"></column>
        </createIndex>

        <addForeignKeyConstraint baseTableName="ASM_PARENTS"
                                 baseColumnNames="asm_id"
                                 constraintName="FK_ASMPARENTS_ASMID"
                                 referencedTableName="ASMS"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

        <addForeignKeyConstraint baseTableName="ASM_PARENTS"
                                 baseColumnNames="asm_parent_id"
                                 constraintName="FK_ASMPARENTS_ASMPARENTID"
                                 referencedTableName="ASMS"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

    </changeSet>

</databaseChangeLog>