Фильтрация и классификация входящих клиентов, A/B тестирование.
=============================================================

## Источники информации о клиенте

* Веб ресурс к которому обращается клиент (паттерн на ресурс)
* Заголовки запроса (в т.ч. cookies)
* UTM параметры запроса (GET параметры)  
* Источник запроса (IP адрес запроса)
* Тело заппроса в определенных случаях (POST/PUT) 

## Фильтр 

Фильтр это тест функция относительно 
источников информации о клиенте    
      
## Действия

Действие это:
        
* Выставление определенных значений в cookies:
    * id правила 
    * id фильтра        
    * кастомное значение key=value в cookies
* Редирект на другой ресурс    
* Переход на другое правило    
* Логгирование
* Системное действие (дергаем программный сервис)                         
                    
## Правила
   
* Имя правила   
* Уникальный идентификатор правила (целочисленный ID) 
* Набор фильтров
* Набор действий  
* Фильтры для правила применяются в том порядке в котором определены. 
* Действия выполняются в том порядке в котором они определены
* Сначала отрабатываются филитры по И и если все фильтры пройдены выполняются действия
* После применения правила в cookie клиента записывается(добавляется) UID примененного правила.
      
Модель данных
-------------
    
    MRRules (    /* Marketing rule */
        ID BIGINT,
        NAME VARCHAR,
        CDATE,
        MDATE                                       
    )
        
    MRFilter2Rule (
            ID,     BIGINT    
            RULE_ID BIGINT,
            ORDINAL BIGINT, /* Порядок фильтра в правиле */
            SPEC    JSON    /* JSON спецификация фильтра */           
        )
    
    MRAction2Rule (  /* Marketing action */
        ID      BIGINT,
        RULE_ID BIGINT,             
        ORDINAL BIGINT, /* Порядок действия в правиле */
        SPEC    JSON    /* JSON спецификация действия */                    
    }
    
    
Применение фильтров
-------------------

При применении фильтров не должно быть никаких обращений к БД

   
   



